<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>THE DIVINE CODE</title>
    <link rel="stylesheet" href="/main-theme.css">
    <link rel="stylesheet" href="/game_shell.css">
</head>
<body class="dark-mode">
    <div id="game-container-wrapper" class="App playing-game">
        <div class="game-playing-container">
            <div class="game-controls-overlay">
                <button onclick="window.location.href='/'" class="control-button">BACK TO THE CREATION</button>
                <button id="fullscreen-button" class="control-button">ENTER THE VOID</button>
            </div>
            
            <div id="game-canvas-wrapper">
                <canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()" tabindex="-1"></canvas>
                <div id="loading-message" class="loading-message" style="display: none;">Summoning divine code...</div>
            </div>
            
            <div class="game-output-console">
                <h3>ORACULAR TRACERIES:</h3>
                <pre id="game-output-pre">Awaiting divine whispers from the depths...</pre>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Theme initialization logic
        (function() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                document.body.classList.remove('dark-mode');
            } else {
                document.body.classList.add('dark-mode');
                document.body.classList.remove('light-mode');
            }
        })();

        var Module = {
            preRun: [],
            postRun: [],
            print: (function() {
                var element = document.getElementById('game-output-pre');
                if (element) element.textContent = ''; // Clear contents
                return function(text) {
                    if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                    console.log(text);
                    if (element) {
                        element.textContent += text + "\n";
                        element.scrollTop = element.scrollHeight;
                    }
                };
            })(),
            printErr: function(text) {
                if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
                console.error(text);
                var errorElement = document.getElementById('game-output-pre');
                if (errorElement) {
                    errorElement.textContent += "ERROR: " + text + "\n";
                    errorElement.scrollTop = errorElement.scrollHeight;
                }
            },
            canvas: (function() {
                var canvas = document.getElementById('canvas');
                return canvas;
            })(),
            setStatus: function(text) {
                var loadingElement = document.getElementById('loading-message');
                if (!loadingElement) return;
                if (text) {
                    loadingElement.textContent = text;
                    loadingElement.style.display = 'block';
                } else {
                    loadingElement.style.display = 'none';
                }
            },
            monitorRunDependencies: function(left) {
                this.setStatus('Summoning... (' + (left ? left + ' remaining' : 'complete') + ')');
            }
        };

        // Fullscreen logic
        document.getElementById('fullscreen-button').addEventListener('click', function() {
            var canvas = document.getElementById('canvas');
            if (canvas) {
                if (!document.fullscreenElement) {
                    if (canvas.requestFullscreen) {
                        canvas.requestFullscreen();
                    } else if (canvas.mozRequestFullScreen) {
                        canvas.mozRequestFullScreen();
                    } else if (canvas.webkitRequestFullscreen) {
                        canvas.webkitRequestFullscreen();
                    } else if (canvas.msRequestFullscreen) {
                        canvas.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    }
                }
            }
        });
    </script>
    {{{ SCRIPT }}}
</body>
</html>